<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KinoBot Admin Paneli</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        :root{--bg-color:#f4f7fa;--sidebar-bg:#1f2937;--text-color:#333;--sidebar-text:#e5e7eb;--primary-color:#3b82f6;--danger-color:#ef4444;--success-color:#22c55e;--border-color:#e5e7eb;}
        *{margin:0;padding:0;box-sizing:border-box;}
        body{font-family:'Inter',sans-serif;display:flex;background-color:var(--bg-color);position:relative;}
        .sidebar{width:250px;background-color:var(--sidebar-bg);color:var(--sidebar-text);height:100vh;display:flex;flex-direction:column;position:fixed;z-index:1100;transition:transform .3s ease-in-out;}
        .sidebar-header{display:flex;justify-content:space-between;align-items:center;padding:1.5rem;background-color:rgba(0,0,0,0.2);}
        .sidebar-header h2{padding:0;margin:0;font-size:1.2rem;}
        .close-sidebar-btn{font-size:1.8rem;cursor:pointer;display:none;}
        .sidebar ul{list-style:none;flex-grow:1;}
        .sidebar ul li a{display:block;padding:1rem 1.5rem;color:var(--sidebar-text);text-decoration:none;transition:background-color .2s;}
        .sidebar ul li a i{margin-right:10px;width:20px;text-align:center;}
        .sidebar ul li.active a,.sidebar ul li a:hover{background-color:var(--primary-color);color:white;}
        .main-content{margin-left:250px;flex-grow:1;padding:2rem;transition: margin-left .3s ease-in-out;}
        header{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem;flex-wrap: wrap; gap: 1rem;}
        .header-left {display: flex; align-items: center; gap: 1rem;}
        header h1{color:var(--text-color);font-size:1.8rem;}
        #menu-toggle{display:none;background:var(--primary-color);}
        .search-container {position: relative; margin-left: auto;}
        .search-container .fa-search {position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: #9ca3af;}
        #searchInput {padding: 0.7rem 1rem 0.7rem 2.5rem; border-radius: 8px; border: 1px solid var(--border-color); font-size: 0.9rem; width: 300px; transition: border-color .2s, box-shadow .2s;}
        #searchInput:focus {outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);}
        .btn{border:none;padding:.5rem .7rem;border-radius:6px;color:white;cursor:pointer;font-size:.9rem;font-weight:500;transition:opacity .2s; margin: 0 2px; text-decoration: none; display: inline-flex; align-items: center; justify-content: center;}
        .btn:hover{opacity:.9;}
        .btn.edit-btn{background-color:var(--success-color);}
        .btn.delete-btn{background-color:var(--danger-color);}
        
        /* YANGI: Statistika kartalari uchun stillar */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        .stat-card {
            background-color: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            position: relative;
            overflow: hidden;
        }
        .stat-card h3 {
            color: #6b7280;
            font-size: 1rem;
            margin-bottom: 0.5rem;
        }
        .stat-card p {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text-color);
        }
        .stat-card > i {
            position: absolute;
            right: 1.5rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 4rem;
            color: rgba(0,0,0,0.05);
        }
        
        .content-table{background-color:white;border-radius:8px;padding:1.5rem;box-shadow:0 4px 6px rgba(0,0,0,0.05);overflow-x:auto;}
        table{width:100%;border-collapse:collapse;}
        th,td{padding:1rem;text-align:left;border-bottom:1px solid var(--border-color);color:var(--text-color);vertical-align:middle;}
        thead th{color:#6b7280;font-weight:600;}
        tbody tr:hover{background-color:#f9fafb;}
        .actions-cell { display: flex; align-items: center; }
        
        @media (max-width: 768px) {
            .sidebar {transform: translateX(-100%);}
            .sidebar.show {transform: translateX(0); box-shadow: 5px 0 15px rgba(0,0,0,0.1);}
            .main-content {margin-left: 0; padding: 1rem;}
            #menu-toggle {display: inline-flex;}
            .close-sidebar-btn {display: block;}
            header {flex-direction: column; align-items: stretch;}
            .header-left { margin-bottom: 1rem; }
            .search-container { margin-left: 0; width: 100%;}
            #searchInput { width: 100%; }
            header h1 {font-size: 1.4rem;}
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="sidebar-header">
            <h2>ðŸŽ¬ KinoBot Panel</h2>
            <span class="close-sidebar-btn">&times;</span>
        </div>
        <ul>
            <li class="active"><a href="#"><i class="fas fa-home"></i> Bosh Sahifa</a></li>
            <li><a href="#"><i class="fas fa-film"></i> Kinolar</a></li>
        </ul>
    </div>

    <div class="main-content">
        <header>
            <div class="header-left">
                <button class="btn" id="menu-toggle"><i class="fas fa-bars"></i></button>
                <h1>Boshqaruv Paneli</h1>
            </div>
            <div class="search-container">
                <i class="fas fa-search"></i>
                <input type="search" id="searchInput" placeholder="Nomi bo'yicha qidirish...">
            </div>
        </header>

        <!-- YANGI: Statistika kartalari -->
        <div class="stats-container">
            <div class="stat-card">
                <h3>Jami Kinolar</h3>
                <p id="total-kinolar">0</p>
                <i class="fas fa-film"></i>
            </div>
        </div>

        <div class="content-table">
            <table>
                <thead>
                    <tr>
                        <th>No</th>
                        <th>Nomi</th>
                        <th>Kodi</th>
                        <th>Amallar</th>
                    </tr>
                </thead>
                <tbody id="kinolarList"></tbody>
            </table>
        </div>
    </div>
    
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const kinolarList = document.getElementById('kinolarList');
        const sidebar = document.querySelector('.sidebar');
        const menuToggle = document.getElementById('menu-toggle');
        const closeSidebarBtn = document.querySelector('.close-sidebar-btn');
        const searchInput = document.getElementById('searchInput');
        const totalKinolarElement = document.getElementById('total-kinolar');

        menuToggle.addEventListener('click', () => sidebar.classList.add('show'));
        closeSidebarBtn.addEventListener('click', () => sidebar.classList.remove('show'));

        async function fetchKinolar() {
            try {
                const response = await fetch('/api/kinolar?X-API-Key={{ secret_key }}');
                if (!response.ok) throw new Error('Server bilan bog`lanishda xatolik');
                const kinolar = await response.json();
                
                if (kinolar.error) throw new Error(kinolar.error);

                // Jami kinolar sonini kartaga yozish
                totalKinolarElement.textContent = kinolar.length;
                
                kinolarList.innerHTML = ''; 
                let i = 0;
                kinolar.forEach(kino => {
                    i++;
                    const row = `
                        <tr>
                            <td>${i}</td>
                            <td>${kino.name}</td>
                            <td>${kino.id}</td>
                            <td>
                                <div class="actions-cell">
                                    <a href="/edit/${kino.id}?secret_key={{ secret_key }}" class="btn edit-btn"><i class="fas fa-pencil-alt"></i></a>
                                    <button class="btn delete-btn" data-id="${kino.id}"><i class="fas fa-trash"></i></button>
                                </div>
                            </td>
                        </tr>
                    `;
                    kinolarList.innerHTML += row;
                });
            } catch (error) {
                kinolarList.innerHTML = `<tr><td colspan="3" style="text-align:center;">Xatolik: ${error.message}</td></tr>`;
                totalKinolarElement.textContent = "N/A";
            }
        }

        async function deleteKino(kinoId) {
             if (!confirm(`${kinoId}-ID'li kinoni o'chirmoqchimisiz?`)) return;
             try {
                const response = await fetch(`/api/kinolar/${kinoId}?X-API-Key={{ secret_key }}`, { method: 'DELETE' });
                const result = await response.json();
                if (result.error) throw new Error(result.error);
                fetchKinolar();
             } catch (error) {
                alert(`Xatolik: ${error.message}`);
             }
        }
        
        kinolarList.addEventListener('click', function(event) {
            const deleteButton = event.target.closest('.delete-btn');
            if (deleteButton) {
                const kinoId = deleteButton.dataset.id;
                deleteKino(kinoId);
            }
        });

        searchInput.addEventListener('input', function() {
            const searchTerm = searchInput.value.toLowerCase().trim();
            const rows = kinolarList.querySelectorAll('tr');
            rows.forEach(row => {
                const kinoNameCell = row.querySelector('td:nth-child(2)');
                if (kinoNameCell) {
                    const kinoName = kinoNameCell.textContent.toLowerCase();
                    row.style.display = kinoName.includes(searchTerm) ? '' : 'none';
                }
            });
        });

        fetchKinolar();
    });
    </script>
</body>
</html>

